#!/usr/bin/env python3
"""
ูููุฏ ุงูุฃููููุงุช ุงูุชููุงุฆู ูู PWA - ุนูุงุฏุฉ ุงูุนุงูุฑ ููุฃุณูุงู
Script to generate PWA icons automatically for Aamer Dental Clinic
"""

import os
from PIL import Image, ImageDraw, ImageFont
import requests

def create_directories():
    """ุฅูุดุงุก ุงููุฌูุฏุงุช ุงููุทููุจุฉ"""
    dirs = ['icons', 'screenshots']
    for dir_name in dirs:
        os.makedirs(dir_name, exist_ok=True)
    print("โ ุชู ุฅูุดุงุก ุงููุฌูุฏุงุช ุงููุทููุจุฉ")

def draw_dental_icon(size, filename):
    """ุฑุณู ุฃููููุฉ ุฃุณูุงู ุจุณูุทุฉ"""
    # ุฅูุดุงุก ุตูุฑุฉ ุฌุฏูุฏุฉ ุจุฎูููุฉ ูุชุฏุฑุฌุฉ
    img = Image.new('RGBA', (size, size), (46, 125, 50, 255))
    draw = ImageDraw.Draw(img)
    
    # ุฑุณู ุฎูููุฉ ุฏุงุฆุฑูุฉ
    margin = size // 16
    draw.rounded_rectangle([margin, margin, size-margin, size-margin], 
                         radius=size//8, fill=(46, 125, 50, 255))
    
    # ุฅุถุงูุฉ ุญุฏ ุฃุจูุถ
    border_width = max(2, size // 50)
    draw.rounded_rectangle([margin, margin, size-margin, size-margin], 
                         radius=size//8, outline=(255, 255, 255, 255), 
                         width=border_width)
    
    # ุฑุณู ุฑูุฒ ุงูุฃุณูุงู (ุจุณูุท)
    center_x, center_y = size // 2, size // 2
    tooth_size = size // 3
    
    # ุฑุณู ุดูู ุณู ุจุณูุท
    points = [
        (center_x - tooth_size//3, center_y - tooth_size//2),
        (center_x + tooth_size//3, center_y - tooth_size//2),
        (center_x + tooth_size//2, center_y),
        (center_x + tooth_size//3, center_y + tooth_size//2),
        (center_x - tooth_size//3, center_y + tooth_size//2),
        (center_x - tooth_size//2, center_y)
    ]
    
    draw.polygon(points, fill=(255, 255, 255, 255))
    
    # ุญูุธ ุงูุตูุฑุฉ
    img.save(f'icons/{filename}', 'PNG')
    print(f"โ ุชู ุฅูุดุงุก {filename}")

def draw_shortcut_icon(size, filename, emoji):
    """ุฑุณู ุฃููููุฉ ุงุฎุชุตุงุฑ"""
    img = Image.new('RGBA', (size, size), (76, 175, 80, 255))
    draw = ImageDraw.Draw(img)
    
    # ุฑุณู ุฎูููุฉ ุฏุงุฆุฑูุฉ
    margin = size // 8
    draw.rounded_rectangle([margin, margin, size-margin, size-margin], 
                         radius=size/6, fill=(76, 175, 80, 255))
    
    # ุฅุถุงูุฉ ุญุฏ ุฃุจูุถ
    border_width = max(1, size // 30)
    draw.rounded_rectangle([margin, margin, size-margin, size-margin], 
                         radius=size/6, outline=(255, 255, 255, 255), 
                         width=border_width)
    
    # ุฑุณู emoji ููุต
    try:
        # ูุญุงููุฉ ุงุณุชุฎุฏุงู ุฎุท ูุจูุฑ
        font_size = size // 2
        font = ImageFont.truetype('/System/Library/Fonts/Arial.ttf', font_size)
    except:
        try:
            font = ImageFont.truetype('/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf', font_size)
        except:
            font = ImageFont.load_default()
    
    # ุญุณุงุจ ููุถุน ุงููุต
    bbox = draw.textbbox((0, 0), emoji, font=font)
    text_width = bbox[2] - bbox[0]
    text_height = bbox[3] - bbox[1]
    
    x = (size - text_width) // 2
    y = (size - text_height) // 2
    
    draw.text((x, y), emoji, font=font, fill=(255, 255, 255, 255))
    
    # ุญูุธ ุงูุตูุฑุฉ
    img.save(f'icons/{filename}', 'PNG')
    print(f"โ ุชู ุฅูุดุงุก {filename}")

def generate_all_icons():
    """ุฅูุดุงุก ุฌููุน ุงูุฃููููุงุช ุงููุทููุจุฉ"""
    print("๐จ ุจุฏุก ุฅูุดุงุก ุฃููููุงุช PWA...")
    
    # ุฃุญุฌุงู ุงูุฃููููุงุช ุงูุฑุฆูุณูุฉ
    main_sizes = [48, 72, 96, 128, 144, 152, 192, 384, 512]
    
    for size in main_sizes:
        filename = f'icon-{size}x{size}.png'
        draw_dental_icon(size, filename)
    
    # ุฃููููุงุช ุงูุงุฎุชุตุงุฑุงุช
    shortcut_configs = [
        ('shortcut-booking.png', '๐'),
        ('shortcut-dashboard.png', 'โก'),
        ('shortcut-pos.png', '๐ณ')
    ]
    
    for filename, emoji in shortcut_configs:
        draw_shortcut_icon(64, filename, emoji)
    
    print(f"๐ ุชู ุฅูุดุงุก {len(main_sizes) + len(shortcut_configs)} ุฃููููุฉ ุจูุฌุงุญ!")

def create_placeholder_screenshots():
    """ุฅูุดุงุก ููุทุงุช ุดุงุดุฉ ูุคูุชุฉ"""
    print("๐ธ ุฅูุดุงุก ููุทุงุช ุดุงุดุฉ ูุคูุชุฉ...")
    
    # ุดุงุดุฉ ุณุทุญ ุงูููุชุจ
    desktop_screenshot = Image.new('RGB', (1280, 720), (232, 245, 232))
    desktop_draw = ImageDraw.Draw(desktop_screenshot)
    
    # ุฑุณู ุนูุงุตุฑ ุฃุณุงุณูุฉ
    desktop_draw.rectangle([50, 100, 600, 500], fill=(255, 255, 255), outline=(200, 200, 200))
    desktop_draw.rectangle([650, 100, 1230, 500], fill=(255, 255, 255), outline=(200, 200, 200))
    
    desktop_screenshot.save('screenshots/desktop-home.png', 'PNG')
    
    # ุดุงุดุฉ ุงููุงุชู ุงููุญููู
    mobile_screenshot = Image.new('RGB', (390, 844), (232, 245, 232))
    mobile_draw = ImageDraw.Draw(mobile_screenshot)
    
    # ุฑุณู ุนูุงุตุฑ ุงููุงุชู
    mobile_draw.rectangle([30, 150, 360, 700], fill=(255, 255, 255), outline=(200, 200, 200))
    
    mobile_screenshot.save('screenshots/mobile-dashboard.png', 'PNG')
    
    print("โ ุชู ุฅูุดุงุก ููุทุงุช ุงูุดุงุดุฉ")

def verify_files():
    """ุงูุชุญูู ูู ูุฌูุฏ ุงููููุงุช"""
    print("\n๐ ุงูุชุญูู ูู ุงููููุงุช:")
    
    expected_files = [
        'manifest.json',
        'service-worker.js',
        'PWA_FIXES_GUIDE.md',
        'icon-generator.html'
    ]
    
    for file in expected_files:
        if os.path.exists(file):
            print(f"โ {file}")
        else:
            print(f"โ {file} - ููููุฏ!")
    
    # ูุญุต ุงูุฃููููุงุช
    icon_count = len([f for f in os.listdir('icons') if f.endswith('.png')])
    print(f"๐ผ๏ธ ุฃููููุงุช: {icon_count}/12")
    
    # ูุญุต ููุทุงุช ุงูุดุงุดุฉ
    screenshot_count = len([f for f in os.listdir('screenshots') if f.endswith('.png')])
    print(f"๐ธ ููุทุงุช ุงูุดุงุดุฉ: {screenshot_count}/2")

def main():
    """ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ"""
    print("๐ฆท ูููุฏ PWA - ุนูุงุฏุฉ ุงูุนุงูุฑ ููุฃุณูุงู")
    print("=" * 50)
    
    # ุฅูุดุงุก ุงููุฌูุฏุงุช
    create_directories()
    
    # ุฅูุดุงุก ุงูุฃููููุงุช
    generate_all_icons()
    
    # ุฅูุดุงุก ููุทุงุช ุงูุดุงุดุฉ
    create_placeholder_screenshots()
    
    # ุงูุชุญูู ูู ุงููููุงุช
    verify_files()
    
    print("\n๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ:")
    print("1. ุงุฑูุน ุฌููุน ุงููููุงุช ุฅูู GitHub")
    print("2. ุงุฐูุจ ุฅูู PWABuilder.com")
    print("3. ุฃุฏุฎู ุฑุงุจุท ูููุนู")
    print("4. ุชุญูู ูู ุญู ุฌููุน ุงููุดุงูู")
    print("5. ุฌุฑุจ ุฅูุดุงุก ุชุทุจูู Android")
    
    print("\nโจ ุชู! ุชุทุจููู ุฌุงูุฒ ููุชุญููู ุฅูู ุชุทุจูู Android!")

if __name__ == "__main__":
    try:
        main()
    except Exception as e:
        print(f"โ ุฎุทุฃ: {e}")
        print("\nุชุฃูุฏ ูู ุชุซุจูุช Pillow: pip install Pillow")